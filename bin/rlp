#!/usr/bin/env node

const rlp = require('../dist/index.js')
const method = process.argv[2]
const raw = process.argv[3]

if (method === 'encode') {
  // Parse JSON
  let json
  try {
    json = JSON.parse(raw)
  } catch (e) {
    return console.error('Error: Could not parse json')
  }
  try {
    const encoded = rlp.encode(json)
    console.log('0x' + encoded.toString('hex'))
  } catch (e) {
    console.error('Error encoding: ' + e)
  }
} else if (method === 'decode') {
  try {
    const decoded = rlp.decode(raw)
    const json = JSON.stringify(baToJSON(decoded))
    console.log(json)
  } catch (e) {
    console.error('Error decoding: ' + e)
  }
} else {
  console.error('Unsupported method')
}

function baToJSON(ba) {
  if (Buffer.isBuffer(ba)) {
    return ba.toString()
  } else if (ba instanceof Array) {
    const arr = []
    for (let i = 0; i < ba.length; i++) {
      arr.push(baToJSON(ba[i]))
    }
    return arr
  }
}
